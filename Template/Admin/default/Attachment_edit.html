<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>附件编辑</title><style>body { font-size:85%; color:#666; font-family:'Microsoft Yahei', Tahoma, Arial!important; font-family:'宋体', Tahoma, Arial; text-align:center; }#edit-form input { width:15em; padding:4px; border:1px solid #CCC; }#edit-form input:focus { border-color:#426DC9; }#edit-form .edit-form-error { background:#FFFBFC; border-color:#F00 !important; }</style><script type="text/javascript" src="__PUBLIC__/js/jquery.min.js"></script><link rel="stylesheet" href="__PUBLIC__/js/artDialog/skins/default.css?4.1.6"><script type="text/javascript" src="__PUBLIC__/js/artDialog/jquery.artDialog.js?skin=default"></script><script type="text/javascript" src="__PUBLIC__/js/artDialog/plugins/iframeTools.js"></script></head><body ><div style="padding:2px;"><div style="margin:4px 0; padding:5px; background:#EEF7F5; text-align:left; color:#000; border-radius:3px; border:1px solid #D7EAE2; " class="tips">请填写新的附件名称<br/><font color="red">(系统会自动帮您添加后缀名)</font></div><form id="edit-form" action="{:U('/Admin/attachment/edit/',array('id'=>$_GET['id']))}" method="post" target="_top"><label>新文件名：</label><input id="file_name" name="file_name" value=""></form></div><script>var id="{$_GET['id']}";var ajaxurl="{:U('/Admin/attachment/edit/')}";(function () {var parent = art.dialog.parent,				// 父页面window对象	api = art.dialog.open.api,	// 			art.dialog.open扩展方法	$ = function (id) {return document.getElementById(id)},	form = $('edit-form'),	file_name = $('file_name');	//alert(art.dialog.data('oldname'));	file_name.value= art.dialog.data('oldname');	if (!api) return;// 操作对话框api.title('编辑附件名称')	// 自定义按钮	.button(		{			name: '修改',			callback: function () {				if (check(file_name)) 				{					var newname=file_name.value+"."+art.dialog.data('ext');;					jQuery.post(ajaxurl,{'id':id,'file_name':newname},function(responce){						if(responce.data='1'){							var win = art.dialog.open.origin;//来源页面							// 如果父页面重载或者关闭其子对话框全部会关闭							art.dialog.close();							//api.title('警告').content('请注意artDialog两秒后将关闭！').lock().time(2);							art.dialog.tips('文件名修改成功！', 3);							win.location.reload();						}else{							art.dialog.tips('文件名修改失败！', 1.5);						}					});				}								return false;			},			focus: true		},		{			name: '取消'		}	);// 表单验证var check = function (input) {	if (input.value === '') {		inputError(input);		input.focus();		return false;	} else {		if(input.value == art.dialog.data('oldname')){			inputError(input);			input.focus();			return false;		}else{			return true;		}	};};	// 输入错误提示var inputError = function (input) {	clearTimeout(inputError.timer);	var num = 0;	var fn = function () {		inputError.timer = setTimeout(function () {			input.className = input.className === '' ? 'edit-form-error' : '';			if (num === 5) {				input.className === '';			} else {				fn(num ++);			};		}, 150);	};	fn();};	window.onload = function () {setTimeout(function () {file_name.focus()}, 240);};})();</script></body></html>